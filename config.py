"""
Конфигурация для RL обучения adversarial кофты
Все параметры проекта собраны здесь
"""


class TrainingConfig:

    # =========================================================================
    # СЕТЬ
    # =========================================================================
    SERVER_HOST = '127.0.0.1'   # IP Raspberry Pi (или localhost для теста)
    SERVER_PORT = 5000

    # =========================================================================
    # КАМЕРА ПК
    # =========================================================================
    PC_CAMERA_INDEX   = 0    # Индекс камеры на ПК
    CAMERA_WARMUP_TIME = 2.0  # Время прогрева камеры (сек)

    # =========================================================================
    # YOLO
    # =========================================================================
    YOLO_MODEL          = 'yolov8n.pt'
    YOLO_CONF_THRESHOLD = 0.25
    TARGET_CLASS        = 0    # class id человека в COCO

    # =========================================================================
    # ЭНКОДЕР ИЗОБРАЖЕНИЙ (MobileNetV2)
    # =========================================================================
    ENCODER_DIM    = 512    # размерность эмбеддинга одной камеры (128 / 256 / 512)
    ENCODER_FREEZE = True   # True = заморозить backbone, обучать только proj

    # Нормализация ImageNet
    IMAGENET_MEAN = [0.485, 0.456, 0.406]
    IMAGENET_STD  = [0.229, 0.224, 0.225]

    # =========================================================================
    # LED / ДЕЙСТВИЕ
    # =========================================================================
    N_LEDS     = 16 * 16 * 38   # количество LED диодов
    # Ограничение яркости: модель генерирует [0, MAX_ACTION],
    # что соответствует [0, MAX_BRIGHTNESS] из 255 при отправке на RPi
    MAX_BRIGHTNESS = 30         # максимальное значение яркости (0-255)

    # =========================================================================
    # ПАРАМЕТРЫ SAC
    # =========================================================================
    GAMMA    = 0.99    # discount factor
    TAU      = 0.005   # soft update coefficient
    ACTOR_LR  = 3e-4
    CRITIC_LR = 3e-4
    ALPHA_LR  = 3e-4

    HIDDEN_DIMS = [256, 256]   # архитектура скрытых слоёв Actor и Critic

    BATCH_SIZE      = 32
    BUFFER_SIZE     = 10000
    LEARNING_STARTS = 100      # начать обучение после N шагов

    # =========================================================================
    # ПАРАМЕТРЫ ОБУЧЕНИЯ
    # =========================================================================
    NUM_EPISODES          = 1000
    MAX_STEPS_PER_EPISODE = 1
    DEVICE                = 'cuda'   # 'cuda' или 'cpu'
    VERBOSE               = True

    # =========================================================================
    # СОХРАНЕНИЕ
    # =========================================================================
    MODELS_DIR       = './checkpoints'
    LOGS_DIR         = './logs'
    DATASET_DIR      = './dataset'
    SAVE_MODEL_EVERY = 1000
    SAVE_DATASET     = True
    SAVE_VISUALIZATION = False

    # =========================================================================
    # ТАЙМАУТЫ СОКЕТОВ
    # =========================================================================
    SOCKET_TIMEOUT         = 10   # сек — ожидание изображений от RPi
    PATTERN_RENDER_TIMEOUT = 60   # сек — ожидание подтверждения отрисовки

    # =========================================================================
    # ВИЗУАЛИЗАЦИЯ
    # =========================================================================
    SHOW_YOLO_DETECTIONS = True
    SHOW_LED_PATTERN     = True
    SHOW_ENV_IMAGES      = True
    VISUALIZATION_DELAY  = 1     # мс; 1 = обновлять каждый кадр, 0 = ждать клавишу

    # Позиции окон OpenCV на экране (x, y) — настройте под свой монитор
    WINDOW_POSITIONS = {
        'YOLO Detection - Adversarial Jacket': (0,    0),
        'LED Pattern':                          (700,  0),
        'RPi Camera 1':                         (0,    550),
        'RPi Camera 2':                         (700,  550),
    }
